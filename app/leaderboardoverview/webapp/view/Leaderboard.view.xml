<mvc:View controllerName="leaderboardoverview.leaderboardoverview.controller.Leaderboard"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:mc="sap.suite.ui.microchart">
    <Page id="page" title="{i18n>title}" showHeader="false" class="sapUiNoContentPadding" busyIndicatorDelay="0" busy="{leaderboard>/busy}">
        <content>
            <VBox width="100%" class="sapUiNoMargin sapUiNoPadding">
                <OverflowToolbar height="2.75rem" design="Transparent">
                    <SegmentedButton selectedKey="{leaderboard>/mode}" selectionChange=".onModeChange">
                        <items>
                            <SegmentedButtonItem key="artists" text="Top Artists"/>
                            <SegmentedButtonItem key="performances" text="Top Performances"/>
                        </items>
                    </SegmentedButton>
                    <ToolbarSpacer/>
                    <MultiComboBox width="18rem"
                        showSecondaryValues="false"
                        placeholder="Filter by genre"
                        enabled="{= !${leaderboard>/selectedArtist} }"
                        selectedKeys="{leaderboard>/selectedGenres}"
                        selectionChange=".onGenreSelectionChange"
                        items="{
                            path: 'leaderboard>/genreOptions'
                        }">
                        <core:Item key="{leaderboard>key}" text="{leaderboard>text}"/>
                    </MultiComboBox>
                    <ComboBox width="18rem"
                        showSecondaryValues="false"
                        showClearIcon="true"
                        placeholder="Filter by artist"
                        visible="{= ${leaderboard>/mode} === 'performances' }"
                        enabled="{= (${leaderboard>/selectedGenres}.length || 0) === 0 }"
                        change=".onArtistSelectionChange"
                        selectedKey="{leaderboard>/selectedArtist}"
                        items="{
                            path: 'leaderboard>/artistOptions'
                        }">
                        <core:Item key="{leaderboard>key}" text="{leaderboard>text}"/>
                    </ComboBox>
                </OverflowToolbar>
                <Table id="leaderboardTable"
                    inset="false"
                    visible="{= ${leaderboard>/mode} === 'artists' }"
                    items="{
                        path: 'leaderboard>/filteredItems'
                    }">
                    <columns>
                        <Column width="4rem" hAlign="Center" demandPopin="true">
                            <Label text="Rank"/>
                        </Column>
                        <Column hAlign="Left" width="18rem" demandPopin="true">
                            <Label text="Artist"/>
                        </Column>
                        <Column hAlign="Left" width="16rem" demandPopin="true" minScreenWidth="Tablet">
                            <Label text="Genres"/>
                        </Column>
                        <Column hAlign="Center" width="12rem" demandPopin="true" minScreenWidth="Tablet">
                            <Label text="Rating trend (by day)"/>
                        </Column>
                        <Column hAlign="Center" width="12rem" demandPopin="true" popinDisplay="Inline">
                            <Label text="Average rating"/>
                        </Column>
                        <Column hAlign="End" width="10rem" demandPopin="true" minScreenWidth="Tablet">
                            <Label text="Reviews"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem vAlign="Middle">
                            <cells>
                                <Text text="{leaderboard>rank}" textAlign="Center"/>
                                <HBox alignItems="Center" width="100%" justifyContent="Start">
                                    <Avatar displayShape="Circle"
                                        displaySize="S"
                                        imageFitType="Cover"
                                        src="{ parts: [{path: 'leaderboard>avatar'}, {path: 'leaderboard>avatarMimeType'}, {path: 'leaderboard>ID'}], formatter: '.toAvatarSrc' }"
                                        fallbackIcon="sap-icon://customer"
                                        initials="{path: 'leaderboard>name', formatter: '.formatInitials'}"/>
                                    <VBox class="sapUiSmallMarginBegin">
                                        <ObjectIdentifier title="{leaderboard>name}" text="{path: 'leaderboard>performanceCount', formatter: '.formatPerformanceCount'}"/>
                                    </VBox>
                                </HBox>
                                <Text text="{path: 'leaderboard>genres', formatter: '.formatGenresList'}" wrapping="true"/>
                                <mc:LineMicroChart width="100%" showPoints="true" points="{
                                    path: 'leaderboard>trendPoints',
                                    templateShareable: false
                                }">
                                    <mc:points>
                                        <mc:LineMicroChartPoint x="{leaderboard>x}" y="{leaderboard>y}"/>
                                    </mc:points>
                                </mc:LineMicroChart>
                                <HBox alignItems="Center" justifyContent="End" width="100%">
                                    <RatingIndicator maxValue="5" value="{leaderboard>averageRating}" displayOnly="true"/>
                                    <ObjectNumber class="sapUiSmallMarginBegin"
                                        number="{path: 'leaderboard>averageRating', formatter: '.formatAverage'}"
                                        unit="avg"
                                        emphasized="false"/>
                                </HBox>
                                <Text text="{path: 'leaderboard>reviewCount', formatter: '.formatReviewCount'}" textAlign="End"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
                <Table id="performanceTable"
                    inset="false"
                    visible="{= ${leaderboard>/mode} === 'performances' }"
                    items="{
                        path: 'leaderboard>/filteredPerformances'
                    }">
                    <columns>
                        <Column width="4rem" hAlign="Center" demandPopin="true">
                            <Label text="Rank"/>
                        </Column>
                        <Column hAlign="Left" width="18rem" demandPopin="true">
                            <Label text="Performance"/>
                        </Column>
                        <Column hAlign="Left" width="16rem" demandPopin="true" minScreenWidth="Tablet">
                            <Label text="Schedule"/>
                        </Column>
                        <Column hAlign="Center" width="12rem" demandPopin="true" popinDisplay="Inline">
                            <Label text="Average rating"/>
                        </Column>
                        <Column hAlign="End" width="10rem" demandPopin="true" minScreenWidth="Tablet">
                            <Label text="Reviews"/>
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem vAlign="Middle">
                            <cells>
                                <Text text="{leaderboard>rank}" textAlign="Center"/>
                                <HBox alignItems="Center" width="100%" justifyContent="Start">
                                    <Avatar displayShape="Circle"
                                        displaySize="S"
                                        imageFitType="Cover"
                                        src="{ parts: [{path: 'leaderboard>avatar'}, {path: 'leaderboard>avatarMimeType'}, {path: 'leaderboard>artistId'}], formatter: '.toAvatarSrc' }"
                                        fallbackIcon="sap-icon://customer"
                                        initials="{path: 'leaderboard>artistName', formatter: '.formatInitials'}"/>
                                    <VBox class="sapUiSmallMarginBegin">
                                        <ObjectIdentifier title="{leaderboard>artistName}" text="{leaderboard>stageName}"/>
                                    </VBox>
                                </HBox>
                                <Text text="{ parts: [{path: 'leaderboard>dayNumber'}, {path: 'leaderboard>dayDate'}, {path: 'leaderboard>startTime'}, {path: 'leaderboard>endTime'}, {path: 'leaderboard>stageName'}], formatter: '.formatPerformanceSlot' }" wrapping="true"/>
                                <HBox alignItems="Center" justifyContent="End" width="100%">
                                    <RatingIndicator maxValue="5" value="{leaderboard>averageRating}" displayOnly="true"/>
                                    <ObjectNumber class="sapUiSmallMarginBegin"
                                        number="{path: 'leaderboard>averageRating', formatter: '.formatAverage'}"
                                        unit="avg"
                                        emphasized="false"/>
                                </HBox>
                                <Text text="{path: 'leaderboard>reviewCount', formatter: '.formatReviewCount'}" textAlign="End"/>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>
        </content>
    </Page>
</mvc:View>
